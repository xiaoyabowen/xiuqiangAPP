<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="telephone=no" name="format-detection">
    <link rel="stylesheet" href="../../css/api.css">
    <link rel="stylesheet" href="../../css/commonWindow.css">

    <title>新生预报名</title>
    <style>
        body{
            background: #F2F2F2;
        }
        .occupy-fee{
            width:100%;
            padding-left:8px;
            padding-right:8px;
            padding-top:12px;
            box-sizing: border-box;
        }
        .of{
            width:100%;
            padding-top:20px;
            padding-bottom:25px;
            background:#FFFFFF;
            box-shadow: 0 2px 4px 0 rgba(90,200,225,0.30);
            border-radius: 4px;
        }
        .of-title{
            font-size: 16px;
            color: #505050;
            letter-spacing: 0.22px;
            padding-left:18px;
            margin-bottom:6px;
        }
        .of-time,.kg-name,.parent-name,.parent-phone{
            padding-left:18px;
            font-size:12px;
            color:#A3A3A3;
            line-height:17px;
        }
        .of-time>:nth-child(2),.kg-name>:nth-child(2),.parent-name>:nth-child(2),.parent-phone>:nth-child(2){
            margin-left:-5px;
        }
        .fee-detail{
            margin-top:19px;
            padding-left:18px;
            padding-right:18px;
            box-sizing: border-box;
        }
        .fd{
            width:100%;
            background: #F8F8F8;
            border: 1px solid #F1F1F1;
            border-radius: 5px; 
        }
        .fd ul{
            width:100%;
            box-sizing: border-box;
        }
        .fd ul li{
            width:100%;
            height:42.5px;
            padding:12px 11.5px 13.5px 12px;
            border-bottom:1px solid #E7E7E7;
            box-sizing: border-box;                        
        }
        .fd ul li .fee-left{
            font-size: 12px;
            color: #9D9D9D;
            letter-spacing: 0.09px;
            float:left;
        }
        .fd ul li .fee-right{
            font-size: 12px;
            color: #574F60;
            letter-spacing: 0.09px;
            float:right;
        }
        .total{
            width:100%;
            height:33.5px;
            line-height:33.5px;
            padding-left:18px;
            padding-right:14px;
            box-sizing: border-box;
        }
        .total .total-left{
            font-size: 12px;
            color: #000000;
            letter-spacing: 0.09px;
            float:left;
        }
        .total .total-right{
            font-size: 14px;
            color: #000000;
            letter-spacing: 0.09px;
            float:right;
        }
        .pay-type{
            width:100%;
            height:46px;
            line-height:46px;
            margin-top:17px;
            border-top: 1px solid #F0F0F0;
            border-bottom: 1px solid #F0F0F0;
            background-image:url('../../image/green_bg.png');
            background-repeat:no-repeat;
            background-position: right 18px center;
        }
        .pay-icon{
            float: left;
        }
        .pay-icon>img{
            width:26px;
            height:26px;
            margin: 10px 0 0 18px;
        }
        .pay-name{
            font-size: 12px;
            color: #A3A3A3;
            margin: 4px;
            letter-spacing: 0.16px;
            line-height: 40px;
            height: 40px;
            float: left;
        }
        .ensure{
            width:90.4%;
            height:44px;
            margin:37px auto auto;
            background: #5AC8E1;
            box-shadow: 0 2px 4px 0 rgba(90,200,225,0.30);
            border-radius: 4px;
            text-align: center;
            line-height:44px;
            font-size: 16px;
            color: #FFFFFF;
        }
        .click{
            background: #ccc;
            color:#fff;
        }
        .paySuccess-modal{
            width:100%;
            height:100%;
            background: rgba(0,0,0,0.50);
            position:fixed;
            top:0;
        }
        .modal-info{
            width:213px;
            height:208px;
            background: #FFFFFF;
            box-shadow: 0 2px 4px 0 rgba(90,200,225,0.30);
            border-radius: 8px;
            text-align: center;
            position: absolute;
            top:50%;
            left:50%;
            margin-top:-104px;
            margin-left:-106.5px;
            background-image: url('../../icon/paySuccess.png');
            background-repeat:no-repeat;
            background-size: 76px;
            background-position:top 40px center;
        }
        .modal-info>div{
            margin-top:160px;
            font-size: 20px;
            color: #515151;
        }
    </style>
</head>
<body>
    <div class="paySuccess-modal" id="paySuccess-modal" style="display: none;">
        <div class="modal-info">
            <div>支付成功</div>
        </div>
    </div>
    <div id="main">

    </div>
</body>
    <script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/mui.min.js"></script>
	<script type="text/javascript" src="../../script/util.js"></script>
	<script type="text/javascript" src="../../script/kv.js"></script>
    <script type="text/javascript" src="../../script/apiCloud.js"></script>
    <script type="text/javascript" src="../../script/public.js"></script>
    <script type="text/javascript" src="./script/init.js"></script>
	<script type="text/javascript" src="../../script/template-native.js"></script>
    <script type="text/javascript" src="../../script/data.js"></script>
    <script type="text/html" id="tmpScript">
        <div class="occupy-fee">
            <div class="of">
                <div class="of-title">新生预约占位费</div>
                <div class="of-time">
                    <span>预约时间：</span>
                    <span><%=list.Ctime%></span>
                </div>
                <div class="kg-name">
                    <span>预约园所：</span>
                    <span><%=list.citySchool%></span>
                    <span><%=list.schoolName%></span>
                </div>
                <div class="parent-name">
                    <span>家长姓名：</span>
                    <span><%=list.parentName%></span>
                </div>
                <div class="parent-phone">
                    <span>家长电话：</span>
                    <span><%=list.phone%></span>
                </div>
                <div class="fee-detail">
                    <div class="fd">
                        <ul>
                            <li>
                                <div class="fee-left">占位费</div>
                                <div class="fee-right"><%=list.price%>元</div>
                            </li>
                        </ul>
                        <div class="total">
                            <div class="total-left">总计</div>
                            <div class="total-right"><%=list.price%>元</div>
                        </div>
                    </div>
                </div>
                <div class="pay-type">
                    <div class="type-info">
                        <span class="pay-icon"><img src="../../image/zfb.png" alt=""></span>
                        <span class="pay-name">支付宝支付</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="ensure" onclick="confirm()" tapmode="click">确认支付</div>
    </script>

    <script>
        var sid;
        var urid;
        apiready = function(){
            var data = {list: api.pageParam.msg};
            var a = formatTimeToDates(data.list.ctime);
            data.list['Ctime'] = a;
            sid = data.list.sid;
            urid = data.list.id;
            uid = data.list.uid;
            var html = template('tmpScript', data);
            document.getElementById('main').innerHTML = html;
        }
        function confirm(){
            var parme = {
                sid:sid,
                urid:urid,
            }
            api.showProgress({
                title: '请求中...',
                text: '请稍等...',
            });

            ajaxGetUser(createAliUserRequestOrder,parme,function(ret,err) {
                api.hideProgress();
                if(ret.success){
                    var oid = ret.data.id;
                    ajaxGetUser(aliUserRequestOrderPayParam,{oid:oid},function(ret,err) {
//                        al(ret);
                        if(ret.success){
                            var aliPay = api.require('aliPay');
                            aliPay.payOrder({
                                orderInfo: ret.data
                            }, function(ret, err) {
                                if(ret.code == 6001){
                                    toast('已取消支付')
                                }else if(ret.code == 9000){
                                    document.getElementById('paySuccess-modal').style.display = 'block';
                                    setTimeout(function () {
                                        document.getElementById('paySuccess-modal').style.display = 'none';
                                        // api.closeToWin({
                                        //     name: 'login'
                                        // });
                                        openNewWindow('login','../RegisterLogin/login.html');
                                    }, 2000);
                                }
                            });
                        }else{
                            toast('请求失败，请重试！')
                        }
                    });
                }
            })


        }
    </script>

</html>