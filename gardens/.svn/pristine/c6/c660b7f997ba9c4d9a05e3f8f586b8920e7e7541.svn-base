<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>园所主页</title>
    <link rel="stylesheet" href="../../css/api.css"/>
    <link rel="stylesheet" href="../../css/commonWindow.css"/>
    <style type="text/css">
        body {
            min-width: 320px;
            background: #F2F2F2;
        }

        .teacher-info {
            width: 100%;
            height: 128px;
            /*background-image: url('../../image/teacherbg.png');*/
            background-repeat: no-repeat;
            background-size: 100% 100%;
            padding-top: 26px;
            padding-left: 21px;
            box-sizing: border-box;
            position: relative;
        }

        .teacher-avatar {
            width: 80px;
            height: 80px;
            position: absolute;
            z-index: 5;
            border-radius: 50%;
            overflow: hidden;
        }

        .teacher-avatar > img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
        }

        .other-info {
            width: 100%;
            padding-left: 95px;
            padding-right: 21px;
            box-sizing: border-box;
            position: relative;
            z-index: 5;
            box-sizing: border-box;
        }

        .class-info {
            font-size: 16px;
            color: #484848;
            line-height: 22px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .class-info > :nth-child(2) {
            margin-left: -10px;
        }

        .address {
            font-size: 14px;
            color: #484848;
            line-height: 20px;
            margin-top: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .address > :nth-child(2) {
            margin-left: -10px;
        }

        .tel {
            font-size: 14px;
            color: #484848;
            line-height: 20px;
            margin-top: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .tel > :nth-child(2) {
            margin-left: -10px;
        }

        /* .contact-way{
            margin-top:9px;
        }
        .contact-way div{
            float:left;
        }
        .msg>img{
            width:22px;
            height:23px;
        }
        .phone{
            padding-top:4px;
        }
        .phone>img{
            width:18px;
            height:18px;
            margin-left:26px;
        } */
        .glory {
            font-size: 14px;
            color: #484848;
            line-height: 20px;
            margin-top: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .glory > :nth-child(2) {
            margin-left: -10px;
        }

        .contact-way {
            margin-top: 9px;
        }

        .contact-way div {
            float: left;
        }

        .msg > img {
            width: 22px;
            height: 23px;
        }

        .phone {
            padding-top: 4px;
        }

        .phone > img {
            width: 18px;
            height: 18px;
            margin-left: 26px;
        }

        .week-cookbook, .splendid-time {
            width: 100%;
            padding-left: 14px;
            padding-right: 13px;
            margin-top: 14px;
            box-sizing: border-box;

        }

        .wc, .st {
            width: 100%;
            background: #FFFFFF;
            box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            padding: 8px 14px 0px 16px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }

        .st {
            padding-bottom: 44px !important;
        }

        .left-icon > img {
            width: 34px;
            height: 34px;
            position: absolute;
            top: 17px;
            left: 16px;
        }

        .right-info {
            width: 100%;
            padding-left: 48px;
            box-sizing: border-box;
        }

        .info-title .left-name {
            font-size: 15px;
            color: #333333;
            line-height: 21px;
            float: left;
            margin-top: 12px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .info-title .right-date {
            font-size: 12px;
            color: #C1C1C1;
            line-height: 17px;
            float: right;
            margin-top: 12px;
        }

        .info-detail {
            clear: both;
            font-size: 12px;
            color: #666666;
            line-height: 17px;

        }

        .info-img {
            width: 100%;
            margin-top: 10px;
        }

        .info-img::after {
            content: "";
            display: block;
            clear: both;
            height: 0;
            overflow: hidden;
            visibility: hidden;
        }

        .info-img li {
            float: left;
            width: 22%;
            margin: 0 4% 4% 0;
        }

        .info-img > :nth-child(4n) {
            margin-right: 0px !important;
        }

        .info-img li figure {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 100%;
        }

        .info-img li figure img {
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            bottom: 0;
            border-radius: 8px;
        }

        .st-img {
            width: 100%;
        }

        .st-img li {
            width: 100%;
            margin-top: 10px;
        }

        .st-img li figure {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 52%;
        }

        .st-img li figure img {
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            bottom: 0;
            border-radius: 8px;
        }

        .listone {
            width: 100%;
            height: 150px;
            overflow: hidden;
            border-radius: 8px;
        }

        .listBfl {
            width: 48.95% !important;
            height: 150px;
            float: left;
            border-radius: 8px 0 0 8px;
            overflow: hidden;
        }

        .listBfr {
            width: 48.95% !important;
            height: 150px;
            float: right;
            border-radius: 0 8px 8px 0;
            overflow: hidden;
        }

        .listImgs {
            float: left !important;
            overflow: hidden;
            border-bottom: none !important;
            width: 32% !important;
            margin-bottom: 5px;
            margin-left: 1%;
            border-radius: 4px;
            height: 90px !important;
        }

        #sharelist ul {
            display: -webkit-box;
            display: -mz-flexbox;
            justify-content: space-between;
            flex-wrap: nowrap;
            box-sizing: border-box;
        }

        #sharelist ul li {
            width: 50px;
            height: 50px;
            margin-left: 30px;
        }

        #sharelist ul li img {
            width: 100%;
            height: 100%;
        }

        #share button {
            width: 100%;
            height: 44px;
            border: 0;
        }

        .bachImg {
            width: 100%;
            height: 128px;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .bachImg img {
            width: 100%;
            height: 100%;
            filter: blur(10px);
            margin: 0 !important;
            padding: 0;
        }

        .ltpic {
            float: left;
            width: 48.65%;
            height: 150px;
            overflow: hidden;
            border-radius: 8px 0 0 8px;
        }

        .rtpic {
            float: right;
            width: 49.05%;
            height: 150px;
            border-radius: 0 8px 8px 0;
            overflow: hidden;
        }

        .rtpic span {
            height: 75px;
            overflow: hidden;
        }

        .ltpic span {
            height: 75px;
            overflow: hidden;
        }

        .ct_content ul li.rtpic img:nth-of-type(1) {
            float: right;
            width: 100%;
            height: 92px;
            border-radius: 0 6px 0 0;
            margin-bottom: 6px;
        }

        .ct_content ul li.rtpic img:nth-of-type(2) {
            float: left;
            width: 100%;
            height: 92px;
            border-radius: 0 0 6px 0;
            margin-bottom: 6px;
        }

        .but {
            width: 56px;
            height: 21px;
            background: #D4602C;
            border-radius: 4px;
            color: #fff;
            font-size: 12px;
            line-height: 21px;
            text-align: center;
            position: absolute;
            left: 80%;
            top: 0;
        }
        .right-info>img {
            width: 60px;
            height: 60px;
            border-radius: 5px;
            margin-top: 12px;
        }
    </style>
</head>
<body>
<div id="dome" style="height: 100%;overflow: auto;">
    <div class="teacher-info">
        <div class="bachImg">
            <img id="Tback" src="../../image/teacherbg.png" alt=""/>
        </div>
        <div class="teacher-avatar">
            <!--<img src="../../image/teacherAvatar.png" alt="">-->
            <img id="Ticon" src="" alt="">
        </div>
        <div class="other-info">
            <div class="class-info">
                <span id="schoolName"></span>
            </div>
            <div class="address">
                <span>地址：</span>
                <span id="schoolAddress"></span>
            </div>
            <div class="tel">
                <span>电话：</span>
                <span id="schoolPhone"></span>
            </div>
            <button class="but" onclick="openEditTheHomePage()">编辑主页</button>
        </div>
    </div>
    <div class="week-cookbook" style="display:none;">
        <div class="wc">
            <div class="left-icon">
                <img src="../../icon/cbicon.png" alt="">
            </div>
            <div class="right-info">
                <div class="info-title">
                    <div class="left-name">每周食谱</div>
                    <div class="right-date">2018.03.15</div>
                </div>
                <div class="info-detail">
                    新天地幼儿园食谱 名称 星期 早餐 加点 午餐 加点 晚餐...
                </div>
                <ul class="info-img">
                    <li>
                        <figure>
                            <img src="../../image/cookfood.png" alt="">
                        </figure>
                    </li>
                    <li>
                        <figure>
                            <img src="../../image/cookfood.png" alt="">
                        </figure>
                    </li>
                    <li>
                        <figure>
                            <img src="../../image/cookfood.png" alt="">
                        </figure>
                    </li>
                    <li>
                        <figure>
                            <img src="../../image/cookfood.png" alt="">
                        </figure>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!--<div class="splendid-time">-->
    <!--<div class="st">-->
    <!--<div class="left-icon">-->
    <!--<img src="../../icon/splendid.png" alt="">-->
    <!--</div>-->
    <!--<div class="right-info">-->
    <!--<div class="info-title">-->
    <!--<div class="left-name">精彩瞬间</div>-->
    <!--<div class="right-date">2018.03.18</div>-->
    <!--</div>-->
    <!--<div class="info-detail">-->
    <!--在这里，记录宝宝的每一个精彩瞬间，留住最美好的记忆-->
    <!--</div>-->
    <!--<ul class="st-img">-->
    <!--<li>-->
    <!--<figure>-->
    <!--<img src="../../image/cookfood.png" alt="">-->
    <!--</figure>-->
    <!--</li>-->
    <!--</ul>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <div class="splendid-time" style="margin-bottom: 12px;">
        <div class="st" id="YsJieshao">
            <div style="height:44px;line-height:44px;text-align:center;">暂无园所介绍</div>
        </div>
    </div>
    <div class="splendid-time" style="margin-bottom: 12px;">
        <div class="st" id="cookBook">
            <div style="height:44px;line-height:44px;text-align:center;">暂无宝宝食谱</div>
        </div>
    </div>
    <div class="splendid-time" onclick="Marvellous()" style="margin-bottom: 20px;">
        <div class="st" id="YmarvellousL">
            <div style="height:44px;line-height:44px;text-align:center;">暂无美乐瞬间</div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-1.8.1.min.js"></script>
<script type="text/javascript" src="../../script/util.js"></script>
<script type="text/javascript" src="../../script/kv.js"></script>
<script type="text/javascript" src="../../script/user.js"></script>
<script type="text/javascript" src="../../script/apiCloud.js"></script>
<script type="text/javascript" src="../../script/public.js"></script>
<script type="text/javascript" src="../../script/template-native.js"></script>
<script type="text/javascript" src="../../script/data.js"></script>
<script type="text/javascript" src="../../script/echo.min.js"></script>
<script type="text/html" id="YmarvellousH">
    <div class="left-icon">
        <img src="../../icon/home/home_01.png" alt="">
    </div>
    <div class="right-info">
        <div class="info-title">
            <div class="left-name">美乐瞬间</div>
            <div class="right-date"><%=list.ctime%></div>
        </div>
        <div class="info-detail">
            <%=list.content%>
        </div>
        <ul class="uldjh">
            <%if(list.images.length == 1){%>
            <li class="listone"><img src="../../icon/jiaxiaoTongHome.jpg" style="width: 100%;height: 100%;" data-echo="<%=list.images[0]%>"
                                     real-style="<%=list.styleJsom%>" alt=""/></li>
            <%} else if(list.images.length == 2){%>
            <li class="listBfl"><img src="../../icon/jiaxiaoTongHome.jpg" style="width: 100%;height: 100%;" data-echo="<%=list.images[0]%>"
                                     real-style="<%=list.styleJsom%>" alt=""/></li>
            <li class="listBfr"><img src="../../icon/jiaxiaoTongHome.jpg" style="width: 100%;height: 100%;" data-echo="<%=list.images[1]%>"
                                     real-style="<%=list.styleJsoma%>" alt=""/></li>
            <%} else if(list.images.length == 3){%>
            <li class="ltpic"><img src="../../icon/jiaxiaoTongHome.jpg" style="width: 100%;height: 100%;" data-echo="<%=list.images[0]%>"
                                   real-style="<%=list.styleJsom%>" alt=""/></li>
            <li class="rtpic">
                <span><img src="../../icon/jiaxiaoTongHome.jpg" data-echo="<%=list.images[1]%>" real-style="<%=list.styleJsoma%>" alt=""/></span>
                <span><img src="../../icon/jiaxiaoTongHome.jpg" data-echo="<%=list.images[2]%>" real-style="<%=list.styleJsomb%>" alt=""/></span>
            </li>
            <%} else if(list.images.length == 4){%>
            <li class="ltpic">
                <span><img src="../../icon/jiaxiaoTongHome.jpg" data-echo="<%=list.images[0]%>" real-style="<%=list.styleJsom%>" alt=""/></span>
                <span><img src="../../icon/jiaxiaoTongHome.jpg" data-echo="<%=list.images[1]%>" real-style="<%=list.styleJsoma%>" alt=""/></span>
            </li>
            <li class="rtpic">
                <span><img src="../../icon/jiaxiaoTongHome.jpg" data-echo="<%=list.images[2]%>" real-style="<%=list.styleJsomb%>" alt=""/></span>
                <span><img src="../../icon/jiaxiaoTongHome.jpg" data-echo="<%=list.images[3]%>" real-style="<%=list.styleJsomc%>" alt=""/></span>
            </li>
            <div style="clear: both"></div>
            <%} else if(list.images.length > 4){%>
            <%for(var i = 0;i < list.images.length;i++){%>
            <li class="listImgs">
                <img src="../../icon/jiaxiaoTongHome.jpg" style="width:100%;height:100%;" data-echo="<%=list.imgJson[i].img%>"
                     real-style="<%=list.imgJson[i].styleJsomobj%>" alt=""/>
            </li>
            <%}%>
            <div style="clear: both"></div>
            <%}%>
        </ul>
    </div>
</script>
<script type="text/html" id="Yuansuojieshao">
    <div class="left-icon">
        <img src="../../icon/ysjieshao.png" alt="">
    </div>
    <div class="right-info">
        <div class="info-title">
            <div class="left-name">园所介绍</div>
            <div class="right-date"><%=list.ctime%></div>
        </div>
        <div class="info-detail" style="font-size: 12px;color: #666666;line-height: 17px;letter-spacing:0.25px;">
            <%=list.content%>
        </div>
    </div>
</script>

<script type="text/html" id="babyCookbook">
    <div class="left-icon">
        <img src="../../icon/cbicon.png" alt="">
    </div>
    <%if(list){%>
    <div class="right-info" onclick="lookCookBook()">
        <div class="info-title">
            <div class="left-name">每周食谱</div>
            <div class="right-date"><%=list.ctime%></div>
        </div>
        <div class="info-detail" style="font-size: 12px;color: #666666;line-height: 17px;letter-spacing:0.25px;">
            <%=list.content%>
        </div>
        <%if(list.imgs.length <= 4){%>
            <%for(var i = 0; i < list.imgs.length;i++){%>
                <img src="<%=list.imgs[i]%>" alt="" />
            <%}%>
        <%}else{%>
            <%for(var i = 0; i < 4;i++){%>
                <img src="<%=list.imgs[i]%>" alt="" />
            <%}%>
        <%}%>
    </div>
    <%}else{%>
    <div class="right-info">
        <div class="info-title">
            <div class="left-name">每周食谱</div>
            <div class="right-date"><%=list.ctime%></div>
        </div>
        <div class="info-detail" style="font-size: 12px;color: #666666;line-height: 17px;letter-spacing:0.25px;">
            暂无宝宝食谱
        </div>
    </div>
    <%}%>
</script>

<script type="text/javascript">

    var uid;
    var icon, userName, chatId;
    var imgArr = [];
    var allResults = {};
    var phoen;
    var honor;
    var userName;
    apiready = function () {
        uid = getUserInfo().id;
        ajaxGet(mainSchool, {uid: uid}, function (ret, err) {
            alert(JSON.stringify(ret))
            if (ret.success == true) {
                //精彩瞬间
                if (ret.data.timeline) {
                    if (ret.data.timeline.images) {
                        ret.data.timeline.images = tryJsonParse(ret.data.timeline.images)
                    };
                    if (ret.data.timeline.ctime) {
                        //渲染精彩瞬间
                        ret.data.timeline.ctime = formatTimeToDateDianLY(ret.data.timeline.ctime);
                    }
//                    //处理精彩瞬间
                    if (ret.data.timeline.images) {
                        //处理imagesJson
                        alert(ret.data.timeline.images.length)
                        if (ret.data.timeline.images.length == 1) {
                            for (var l = 0; l < ret.data.timeline.images; l++) {
                                var width = api.winWidth - 40;
                                var height = 150;
                                var obj = getImgByThisSize(ret.data.timeline.images[0], width, height);
                                ret.data.timeline.styleJsom = obj.style;
                            }
                        } else if (ret.data.timeline.images.length == 2) {
                            for (var l = 0; l < ret.data.timeline.images; l++) {
                                var width = api.winWidth * 0.4865;
                                var widtha = api.winWidth * 0.4905;
                                var height = 150;
                                var obj = getImgByThisSize(ret.data.timeline.images[0], width, height);
                                var obja = getImgByThisSize(ret.data.timeline.images[1], widtha, height);
                                ret.data.timeline.styleJsom = obj.style;
                                ret.data.timeline.styleJsoma = obja.style;
                            }
                        } else if (ret.data.timeline.images.length == 3) {
                            var width = api.winWidth * 0.4865;
                            var widtha = api.winWidth * 0.4905;
                            var height = 150;
                            var heighta = 75;
                            var obj = getImgByThisSize(ret.data.timeline.images[0], width, height);
                            var obja = getImgByThisSize(ret.data.timeline.images[1], widtha, heighta);
                            var objb = getImgByThisSize(ret.data.timeline.images[2], widtha, heighta);
                            ret.data.timeline.styleJsoma = obja.style;
                            ret.data.timeline.styleJsomb = objb.style;
                            ret.data.timeline.styleJsom = obj.style;
                        } else if (ret.data.timeline.images.length == 4) {
                            var width = api.winWidth * 0.4865;
                            var widtha = api.winWidth * 0.4905;
                            var height = 75;
                            var obj = getImgByThisSize(ret.data.timeline.images[0], width, height);
                            var obja = getImgByThisSize(ret.data.timeline.images[1], width, height);
                            var objb = getImgByThisSize(ret.data.timeline.images[2], widtha, height);
                            var objc = getImgByThisSize(ret.data.timeline.images[3], widtha, height);
                            ret.data.timeline.styleJsoma = obja.style;
                            ret.data.timeline.styleJsomb = objb.style;
                            ret.data.timeline.styleJsom = obj.style;
                            ret.data.timeline.styleJsomc = objc.style;
                        } else if (ret.data.timeline.images.length > 4) {
                            var imgArr = [];
                            ret.data.timeline.imgJson = [];
                            for (var l = 0; l < ret.data.timeline.images.length; l++) {
                                var width = (api.winWidth - 43) / 3;
                                var height = 75;
                                var obj = getImgByThisSize(ret.data.timeline.images[l], width, height);
                                var imgArr = {
                                    img: ret.data.timeline.images[l],
                                    styleJsomobj: obj.style
                                };
                                ret.data.timeline.imgJson.push(imgArr);
                            }
                        }
                    }

                    var data = {list: ret.data.timeline};
                    var html = template('YmarvellousH', data);
                    document.getElementById('YmarvellousL').innerHTML = html;
                    setTimeout(function () {
                        echoExt.init({
                            offset: 0,
                            throttle: 0//设置图片延迟加载的时间
                        });
                    }, 100)
                }

                //园所介绍
                if (ret.data.school) {
                    if (ret.data.school.icon) {
                        icon = ret.data.school.icon;
                        var listicon = ret.data.school.icon;
                        var width = 80;
                        var height = 80;
                        var obj = getImgByThisSize(listicon, width, height);
                        ret.data.school.style = obj.style;
                        $("#Ticon").attr("src", obj.url);
                    } else {
                        icon = "";
                        $("#Ticon").attr("src", "../../image/teacherAvatar.png");
                        $("#Ticon").attr("style", "width:100%;height:100%");
                    }
                    $("#schoolName").html(ret.data.school.name);
                    $("#schoolAddress").html(ret.data.school.address);
                    $("#schoolPhone").html(ret.data.school.phone);
                    if (ret.data.school.ctime) {
                        //渲染精彩瞬间
                        ret.data.school.ctime = formatTimeToDateDianLY(ret.data.school.ctime);
                    }
                    var data = {list: ret.data.school};
                    var html = template('Yuansuojieshao', data);
                    document.getElementById('YsJieshao').innerHTML = html;
                }
                
                //食谱
                if (ret.data.cookbook) {
                    var cookBookData = {};
                    var one = ret.data.cookbook.indexOf('['); //查找 '['
                    var two = ret.data.cookbook.indexOf(']');//查找 ']'
                    var imgArr = ret.data.cookbook.substring(one+1,two).split(','); //截取[]之间的url按 ，转换成arr
                    var Content = ret.data.cookbook.substring(0,one-1);
                    var time = formatTimeToDateDianLY(parseInt(ret.data.cookbook.substring(two+2)));
                    cookBookData.content = Content;
                    cookBookData.imgs = imgArr;
                    cookBookData.ctime = time;
                    var data = {list: cookBookData};
                    var html = template('babyCookbook', data);
                    document.getElementById("cookBook").innerHTML = html;
                }
                phoen = ret.data.phone;
                userName = ret.data.name;
                if (ret.data.icon) {
                    icon = ret.data.icon;
                    //头像
                    var listicon = ret.data.user.icon;
                    var width = 80;
                    var height = 80;
                    var obj = getImgByThisSize(listicon, width, height);
                    ret.data.user.style = obj.style;
                    //老师头像
                    $("#Ticon").attr("src", obj.url);
                    $("#Ticon").attr("style", ret.data.user.style);
                } else {
                    //老师头像
                    icon = "";
                    $("#Ticon").attr("src", "../../image/teacherWang.png");
                    $("#Ticon").attr("style", "width:100%;height:100%");
                }
            }
        })
    }

    //打电话
    function Phoen() {
        openCall(phoen)
    }

    function openPhotoBrowser() {
    }

    function Marvellous() {
        openNewWindow("wonderfulTime", "../wonderfulTime/wonderfulTime.html");
    }

    function openEditTheHomePage() {
        openNewWindow("gardenHomePage", "../babyHealth/gardenHomePage.html")
    }
    function lookCookBook(){
        openNewWindow('babyCookBook','../babyCookBook/babyCookBook.html');
    };

    function openUserChat() {
        //先要通知原生  告知这个人要聊天了
        api.accessNative({
            name: "openChatList",
            extra: {
                key: {
                    id: chatId,
                    icon: icon || "",
                    name: userName || ""
                }
            }

        }, function (ret, err) {

        });
    };
</script>
</html>